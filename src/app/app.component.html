<p-toast />

<div class="flex flex-column overflow-hidden w-full h-full">
  <div class="flex-grow">
    <app-header />
  </div>

  <!-- TreeSelect para navegación -->
  <div class="p-2 md:p-4 w-full md:w-auto">
    <p-treeselect
      class="w-full md:w-80"
      [(ngModel)]="selectedRoute"
      [options]="routeOptions"
      placeholder="Seleccione una ruta"
      (onNodeSelect)="onRouteSelect($event)"
      selectionMode="single"
      panelStyleClass="w-full md:w-80"
      [metaKeySelection]="false"
    >
      <ng-template let-node pTemplate="option">
        <div class="flex align-items-center">
          <i [class]="node.icon" class="mr-2"></i>
          <span>{{ node.label }}</span>
        </div>
      </ng-template>
    </p-treeselect>
  </div>

  <div class="w-full h-full flex-grow overflow-hidden z-0">
    <p-scrollPanel styleClass="w-full h-full">
      <router-outlet class="w-full h-full"></router-outlet>
    </p-scrollPanel>
  </div>
</div>

<!-- Drawer (sidebar) -->
<div class="card flex justify-center">
  <p-drawer [(visible)]="sidebarVisible" position="left" styleClass="w-18rem" [showCloseIcon]="false" (onHide)="onSidebarHide()">
    <ng-template pTemplate="header">
      <div class="flex align-items-center justify-content-between px-4 py-3 border-bottom-1 surface-border relative">
        <img src="images/logo.png" alt="Logo" class="w-10rem">
        <button
          pButton
          icon="pi pi-times"
          class="p-button-rounded p-button-text p-button-plain absolute right-0 top-0"
          (click)="closeSidebar()"></button>
      </div>
    </ng-template>

    <div class="h-full flex flex-column">
      <!-- Menú de navegación -->
      <div class="overflow-y-auto flex-grow-1">
        <ul class="list-none p-2 m-0">
          <!-- Elemento Facturación -->
          <li>
            <a pRipple
              routerLink="/billing"
              routerLinkActive="active-route"
              [routerLinkActiveOptions]="{exact: true}"
              class="flex align-items-center cursor-pointer p-3 border-round text-700 hover:surface-100 transition-duration-150 transition-colors w-full"
              (click)="closeSidebar()">
              <i class="pi pi-dollar mr-3"></i>
              <span class="font-medium">Facturación</span>
            </a>
          </li>

          <!-- Elemento Causaciones -->
          <li>
            <a pRipple
              routerLink="/causations"
              routerLinkActive="active-route"
              [routerLinkActiveOptions]="{exact: true}"
              class="flex align-items-center cursor-pointer p-3 border-round text-700 hover:surface-100 transition-duration-150 transition-colors w-full"
              (click)="closeSidebar()">
              <i class="pi pi-calculator mr-3"></i>
              <span class="font-medium">Causaciones</span>
            </a>
          </li>

          <!-- Elemento Reportes con submenú -->
          <li>
            <div pRipple
              [class.active-parent]="isReportsActive()"
              class="flex align-items-center cursor-pointer p-3 border-round text-700 hover:surface-100 transition-duration-150 transition-colors w-full"
              (click)="toggleReports($event)">
              <i class="pi pi-briefcase mr-3"></i>
              <span class="font-medium">Reportes</span>
              <i class="pi pi-chevron-down ml-auto transition-all duration-300"
                [class.rotate-180]="isReportsExpanded"></i>
            </div>

            <!-- Subitems de Reportes -->
            <div class="overflow-hidden transition-all duration-300 ease-in-out"
                [style.max-height]="isReportsExpanded ? '200px' : '0'">
              <ul class="list-none p-0 pl-6">
                <li>
                  <a pRipple
                    routerLink="/reports/sales"
                    routerLinkActive="active-route"
                    [routerLinkActiveOptions]="{exact: true}"
                    class="flex align-items-center cursor-pointer p-3 pl-4 border-round text-600 hover:surface-50 transition-duration-150 transition-colors w-full text-sm"
                    (click)="closeSidebar()">
                    <i class="pi pi-chart-bar mr-3 text-sm"></i>
                    <span>Reportes en Ventas</span>
                  </a>
                </li>
              </ul>
            </div>
          </li>

          <!-- Elemento Proveedores -->
          <li>
            <a pRipple
              routerLink="/suppliers"
              routerLinkActive="active-route"
              [routerLinkActiveOptions]="{exact: true}"
              class="flex align-items-center cursor-pointer p-3 border-round text-700 hover:surface-100 transition-duration-150 transition-colors w-full"
              (click)="closeSidebar()">
              <i class="pi pi-users mr-3"></i>
              <span class="font-medium">Proveedores</span>
            </a>
          </li>

          <!-- Elemento Configuración -->
          <li>
            <a pRipple
              routerLink="/config"
              routerLinkActive="active-route"
              [routerLinkActiveOptions]="{exact: true}"
              class="flex align-items-center cursor-pointer p-3 border-round text-700 hover:surface-100 transition-duration-150 transition-colors w-full"
              (click)="closeSidebar()">
              <i class="pi pi-cog mr-3"></i>
              <span class="font-medium">Configuración</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </p-drawer>
</div>
