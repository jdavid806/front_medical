<!-- Main Header Section -->
<div class="flex items-center justify-between mb-4 bg-white p-3 rounded-lg shadow-md">
  <!-- Left Section - Back Button -->
  <div class="flex-1 flex justify-start">
    <p-button
      label="{{ 'ACCOUNTANT' | translate }} - {{ 'MOVEMENTS' | translate }}"
      icon="pi pi-arrow-left"
      styleClass="p-button-text p-button-secondary"
      [raised]="true"
      routerLink="/causations/movements">
    </p-button>
  </div>

  <!-- Center Section - Title -->
  <div class="flex-1">
    <h1 class="text-2xl font-bold mb-1">
      {{ "NEW_CASH_PAYMENT" | translate }}
    </h1>
    <!-- Blue underline decoration -->
    <div class="w-20 h-1 bg-blue-500 mx-auto"></div>
  </div>

  <!-- Right Section - Create New Button -->
  <div class="flex-2 flex justify-end">
    <p-button
      icon="pi pi-check"
      [raised]="true"
      label="Crear Nuevo Tercero"
      (click)="showNewCustomerDialog()">
    </p-button>
  </div>
</div>

<!-- Main Content Container -->
<div class="w-full p-4 flex flex-column align-items-center">
  <div class="w-full" style="max-width: 900px; min-height: 100vh">
    <!-- Form Card -->
    <div class="card shadow-2 p-3">
      <form [formGroup]="form" class="h-full">
        <!-- Two-column Grid Layout -->
        <div class="grid">
          <!-- Left Column - Primary Fields -->
          <div class="col-12 md:col-6 pr-0 md:pr-3">

            <!-- Type Selection Field -->
            <div class="mb-3">
              <label class="block mb-1 font-medium">{{ "TYPE" | translate }} *</label>
              <p-select
                [options]="typeOptions"
                formControlName="type"
                optionLabel="name"
                placeholder="{{ 'SELECT_TYPE' | translate }}"
                class="w-full"
                [ngClass]="{'ng-invalid ng-dirty': form.get('type')?.invalid && form.get('type')?.touched}"
                [filter]="true"
                filterBy="name"
                [showClear]="true">
              </p-select>
            </div>

            <!-- Suppliers Selection Field -->
            <div class="mb-3">
              <label class="block mb-1 font-medium">{{ "SUPPLIERS_OTHERS" | translate }} *</label>
              <p-select
                [options]="customers"
                formControlName="customer"
                optionLabel="fullName"
                placeholder="{{ 'SELECT_TYPE' | translate }}"
                class="w-full"
                [ngClass]="{'ng-invalid ng-dirty': form.get('customer')?.invalid && form.get('customer')?.touched}"
                [filter]="true"
                filterBy="name"
                [showClear]="true">
              </p-select>
            </div>

            <!-- Make Payment Selection Field -->
            <div class="mb-3">
              <label class="block mb-1 font-medium">{{ "MAKE_PAYMENT" | translate }} *</label>
              <p-select
                [options]="makepayment"
                formControlName="make"
                optionLabel="name"
                placeholder="{{ 'SELECT_MAKE_PAYMENT' | translate }}"
                class="w-full"
                [ngClass]="{'ng-invalid ng-dirty': form.get('make')?.invalid && form.get('make')?.touched}"
                [filter]="true"
                filterBy="name"
                [showClear]="true">
              </p-select>
            </div>

            <!-- Money Source Selection Field -->
            <div class="mb-3">
              <label class="block mb-1 font-medium">{{ "MONEY_SOURCE" | translate }} *</label>
              <p-select
                [options]="moneySourceOptions"
                formControlName="moneySource"
                optionLabel="name"
                placeholder="{{ 'SELECT_SOURCE' | translate }}"
                class="w-full"
                [ngClass]="{'ng-invalid ng-dirty': form.get('moneySource')?.invalid && form.get('moneySource')?.touched}"
                [filter]="true"
                filterBy="name"
                [showClear]="true">
              </p-select>
            </div>
          </div>

          <!-- Right Column - Secondary Fields -->
          <div class="col-12 md:col-6 pl-0 md:pl-3">
            <!-- Invoice Number Field -->
            <div class="mb-3">
              <label class="block mb-1 font-medium">{{ "INVOICE_NUMBER" | translate }} *</label>
              <input pInputText class="w-full" formControlName="invoiceNumber">
            </div>

            <!-- Creation Date Field -->
            <div class="mb-3">
              <label class="block mb-1 font-medium">{{ "CREATION_DATE" | translate }} *</label>
              <p-datepicker
                formControlName="creationDate"
                [iconDisplay]="'input'"
                [showIcon]="true"
                [showButtonBar]="true"
                inputId="icondisplay"
                dateFormat="dd/mm/yy"
                inputStyleClass="w-full"
                styleClass="w-full"
                [ngClass]="{'ng-invalid ng-dirty': form.get('creationDate')?.invalid && form.get('creationDate')?.touched}">
              </p-datepicker>
            </div>

            <!-- Cost Center Selection Field -->
            <div class="mb-3">
              <label class="block mb-1 font-medium">{{ "COST_CENTER" | translate }} *</label>
              <p-select
                [options]="costCenterOptions"
                formControlName="costCenter"
                optionLabel="name"
                placeholder="{{ 'SELECT_COST_CENTER' | translate }}"
                class="w-full"
                [ngClass]="{'ng-invalid ng-dirty': form.get('costCenter')?.invalid && form.get('costCenter')?.touched}"
                [filter]="true"
                filterBy="name"
                [showClear]="true">
              </p-select>
            </div>

            <!-- Amount Paid Field -->
            <div class="mb-3">
              <label class="block mb-1 font-medium">{{ "AMOUNT_PAID" | translate }} *</label>
              <p-inputNumber
                mode="currency"
                currency="USD"
                locale="en-US"
                formControlName="amountPaid"
                [min]="0"
                class="w-full"
                [ngClass]="{'ng-invalid ng-dirty': form.get('amountPaid')?.invalid && form.get('amountPaid')?.touched}">
              </p-inputNumber>
            </div>
          </div>

          <!-- Full Width Observations Field -->
          <div class="col-12 mt-2">
            <div class="field">
              <label class="block mb-1 font-medium">{{ "OBSERVATIONS" | translate }} *</label>
              <textarea
                rows="4"
                formControlName="observations"
                class="w-full border-1 surface-border border-round p-2"
                style="resize: none"
                [ngClass]="{'ng-invalid ng-dirty': form.get('observations')?.invalid && form.get('observations')?.touched}">
              </textarea>
            </div>
          </div>
        </div>

        <!-- Form Action Buttons -->
        <div class="button-container">
          <div class="button-group">
            <!-- Cancel Button -->
            <p-button
              icon="pi pi-times"
              class="action-button"
              variant="text"
              label="Cancelar"
              [raised]="true"
              severity="secondary">
            </p-button>

            <!-- Save Button -->
            <p-button
              icon="pi pi-save"
              class="action-button"
              [raised]="true"
              label="Guardar y Descargar"
              [disabled]="form.invalid">
            </p-button>

            <!-- Download Button -->
            <p-button
              icon="pi pi-download"
              class="action-button"
              label="Descargar"
              [raised]="true">
            </p-button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Credit Note Modal Component -->
<app-modal-credit-note
  (creditNoteCreated)="onCreditNoteCreated($event)"
  (onHide)="customerDropdownOpen = false">
</app-modal-credit-note>
